{% extends "base.html" %}

{% block title %}관심종목 — WEStock{% endblock %}
{% block nav_watchlist %}active{% endblock %}

{% block content %}
<section class="panel">
  <div class="panel-head">
    <h2><span class="material-icons-round">star</span>내 관심종목</h2>
    {% if watchlist_limit %}
    <span class="panel-badge">Free · 최대 {{ watchlist_limit }}개</span>
    {% else %}
    <span class="panel-badge">무제한</span>
    {% endif %}
  </div>

  <form method="post" action="{% url 'watchlist:create' %}" class="watchlist-inline-form">
    {% csrf_token %}
    <input type="hidden" name="next" value="{% url 'watchlist:list' %}">
    <input id="watchlist-name" type="text" name="name" maxlength="120" required placeholder="새 워치리스트 이름 입력...">
    <button type="submit"><span class="material-icons-round" style="font-size:1rem">add</span>생성</button>
  </form>
</section>

{% for watchlist in watchlists %}
<section class="panel watchlist-block">
  <div class="panel-head">
    <h2>
      <span class="material-icons-round">folder</span>
      {{ watchlist.name }}{% if watchlist.is_default %} <span class="panel-badge">기본</span>{% endif %}
    </h2>
    <form method="post" action="{% url 'watchlist:delete' watchlist.id %}" class="inline-form">
      {% csrf_token %}
      <input type="hidden" name="next" value="{% url 'watchlist:list' %}">
      <button type="submit" style="color: var(--down); border-color: rgba(239,68,68,0.2);">
        <span class="material-icons-round" style="font-size:0.9rem">delete</span>삭제
      </button>
    </form>
  </div>

  <ul style="list-style: none;">
    {% for item in watchlist.items.all %}
    <li class="watchlist-item-row">
      <div>
        <a href="{% url 'stocks:detail' item.stock.symbol %}">{{ item.stock.symbol }}</a>
        {% if item.note %}
        <span class="meta-note">— {{ item.note }}</span>
        {% endif %}
      </div>
      <form method="post" action="{% url 'watchlist:remove-item' item.stock.symbol %}" class="inline-form">
        {% csrf_token %}
        <input type="hidden" name="watchlist_id" value="{{ watchlist.id }}">
        <input type="hidden" name="next" value="{% url 'watchlist:list' %}">
        <button type="submit" style="padding:0.3rem 0.6rem;font-size:0.78rem;">제거</button>
      </form>
    </li>
    {% empty %}
    <li class="empty-note">종목이 없습니다.</li>
    {% endfor %}
  </ul>
</section>
{% empty %}
<section class="panel">
  <p class="empty-note">아직 관심종목 목록이 없습니다. 위에서 생성해보세요!</p>
</section>
{% endfor %}
{% endblock %}